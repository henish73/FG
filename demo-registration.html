<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>üíô Book Your FREE Demo Class | FRENCH.GTA</title>
    <meta name="description" content="Book your free French demo class instantly. Choose from available time slots and start your French learning journey with FRENCH.GTA today.">
    <link rel="stylesheet" href="styles.css">
    <link rel="icon" href="img/french.gta logo.jpg" type="image/x-icon">
    <script src="script.js" defer></script>
    <link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.0.0/css/all.min.css">
</head>
<body>
    <div id="header-placeholder"></div>

    <main class="main-content">
        <!-- Hero Section -->
        <section class="booking-hero">
            <div class="hero-content">
                <h1>üíô Book Your FREE Demo Class</h1>
                <p class="hero-subtitle">Choose a time that works for you and meet your French instructor</p>
                
                <div class="demo-benefits-quick">
                    <div class="benefit-item">
                        <i class="fas fa-heart"></i>
                        <span>Meet your caring instructor</span>
                    </div>
                    <div class="benefit-item">
                        <i class="fas fa-clock"></i>
                        <span>1-hour session</span>
                    </div>
                    <div class="benefit-item">
                        <i class="fab fa-google"></i>
                        <span>Online via Google Meet</span>
                    </div>
                    <div class="benefit-item">
                        <i class="fas fa-gift"></i>
                        <span>Completely FREE</span>
                    </div>
                </div>
            </div>
        </section>

        <!-- Booking Interface -->
        <section class="booking-interface">
            <div class="booking-container">
                <!-- Calendar Section -->
                <div class="calendar-section">
                    <div class="calendar-header">
                        <h3>üìÖ Choose Your Preferred Date</h3>
                        <div class="month-navigation">
                            <button id="prevMonth" class="nav-btn">
                                <i class="fas fa-chevron-left"></i>
                            </button>
                            <span id="currentMonth" class="month-display"></span>
                            <button id="nextMonth" class="nav-btn">
                                <i class="fas fa-chevron-right"></i>
                            </button>
                        </div>
                    </div>
                    
                    <div class="calendar-grid" id="calendarGrid">
                        <!-- Calendar days will be generated by JavaScript -->
                    </div>
                </div>

                <!-- Time Slots Section -->
                <div class="timeslots-section">
                    <div class="timeslots-header">
                        <h3>‚è∞ Available Time Slots</h3>
                        <p id="selectedDateDisplay">Please select a date first</p>
                    </div>
                    
                    <div class="timeslots-grid" id="timeSlotsGrid">
                        <div class="no-date-selected">
                            <i class="fas fa-calendar-alt"></i>
                            <p>Select a date to see available times</p>
                        </div>
                    </div>
                </div>
            </div>
        </section>

        <!-- Booking Form -->
        <section class="booking-form-section" id="bookingFormSection" style="display: none;">
            <div class="form-container">
                <h3>üìù Almost There! Just a Few Details</h3>
                <div class="selected-slot-display" id="selectedSlotDisplay"></div>
                
                <form id="demoBookingForm" class="booking-form">
                    <div class="form-row">
                        <div class="form-group">
                            <label for="firstName">First Name</label>
                            <input type="text" id="firstName" name="firstName" placeholder="Your first name" required>
                        </div>
                        <div class="form-group">
                            <label for="lastName">Last Name</label>
                            <input type="text" id="lastName" name="lastName" placeholder="Your last name" required>
                        </div>
                    </div>
                    
                    <div class="form-group">
                        <label for="email">Email Address</label>
                        <input type="email" id="email" name="email" placeholder="we'll send your confirmation here" required>
                    </div>
                    
                    <div class="form-group">
                        <label for="frenchLevel">Your French Level</label>
                        <select id="frenchLevel" name="frenchLevel" required>
                            <option value="">Please select your level</option>
                            <option value="complete-beginner">Complete Beginner - I'm just starting</option>
                            <option value="false-beginner">False Beginner - I know a little</option>
                            <option value="elementary">Elementary - I can say basic things</option>
                            <option value="intermediate">Intermediate - I can have simple conversations</option>
                            <option value="advanced">Advanced - I'm quite comfortable</option>
                            <option value="not-sure">Not sure - let's figure it out together!</option>
                        </select>
                    </div>
                    
                    <div class="form-actions">
                        <button type="button" id="backToSlots" class="btn-secondary">
                            <i class="fas fa-arrow-left"></i> Change Time
                        </button>
                        <button type="submit" class="cta-button">
                            <i class="fas fa-calendar-check"></i> Confirm My Demo Class
                        </button>
                    </div>
                </form>
            </div>
        </section>

        <!-- Confirmation Section -->
        <section class="confirmation-section" id="confirmationSection" style="display: none;">
            <div class="confirmation-container">
                <div class="confirmation-icon">
                    <i class="fas fa-check-circle"></i>
                </div>
                <h2>üéâ Demo Class Booked Successfully!</h2>
                <div class="confirmation-details" id="confirmationDetails"></div>
                
                <div class="next-steps">
                    <h3>üíù What Happens Next:</h3>
                    <ul class="next-steps-list">
                        <li><i class="fas fa-envelope"></i> You'll receive a confirmation email with Google Meet details</li>
                        <li><i class="fas fa-calendar"></i> Add this appointment to your calendar</li>
                        <li><i class="fas fa-heart"></i> We'll send a friendly reminder 1 day before</li>
                        <li><i class="fab fa-google"></i> Join the Google Meet call at your scheduled time</li>
                    </ul>
                </div>
                
                <div class="email-section">
                    <h3>üìß Send Confirmation Email</h3>
                    <p>Click below to send yourself a professional confirmation email with all the details:</p>
                    <button id="sendEmailBtn" class="cta-button">
                        <i class="fas fa-paper-plane"></i> Send Confirmation Email
                    </button>
                </div>
                
                <div class="confirmation-actions">
                    <a href="services.html" class="cta-button">
                        <i class="fas fa-compass"></i> Explore Our Programs
                    </a>
                    <button onclick="bookAnotherDemo()" class="btn-secondary">
                        <i class="fas fa-plus"></i> Book Another Demo
                    </button>
                </div>
            </div>
        </section>
    </main>

    <div id="footer-placeholder"></div>

    <script>
        const monthNames = ["January", "February", "March", "April", "May", "June", "July", "August", "September", "October", "November", "December"];
        const dayNames = ["Sun", "Mon", "Tue", "Wed", "Thu", "Fri", "Sat"];
        const calendarEl = document.getElementById('calendar');
        const monthYearEl = document.getElementById('monthYear');
        const timeSlotsEl = document.getElementById('timeSlots');
        const availableSlots = { // Admin defines available slots here (YYYY-MM-DD: [HH:MM, HH:MM])
            // Example: "2024-03-15": ["10:00", "14:00", "18:00"], (Add more dates and times)
            // THIS IS THE DEMO DATA - REPLACE WITH ACTUALS
            "2024-07-29": ["10:00", "11:30", "14:00", "16:30"],
            "2024-07-30": ["09:00", "10:30", "15:00"],
            "2024-08-01": ["10:00", "14:00"],
            "2024-08-02": ["11:00", "15:30"],
            "2024-08-05": ["10:00", "11:30", "14:00", "16:30", "18:00"]
            // Ensure dates are in the future and times are reasonable for demo classes
        };
        const ADMIN_EMAIL = 'frenchgta.ca@gmail.com';
        const GOOGLE_MEET_LINK = 'https://meet.google.com/your-demo-link'; // ADMIN: Update this link!

        let currentMonth, currentYear;
        let selectedDate = null;
        let selectedTime = null;
        let bookingData = null; // To store name, email, etc.

        function generateCalendar(month, year) {
            calendarEl.innerHTML = ''; // Clear previous calendar
            monthYearEl.textContent = `${monthNames[month]} ${year}`;
            currentMonth = month;
            currentYear = year;

            const firstDay = new Date(year, month, 1).getDay();
            const daysInMonth = new Date(year, month + 1, 0).getDate();

            // Add day headers (Sun, Mon, ...)
            const headerRow = document.createElement('div');
            headerRow.classList.add('calendar-header');
            dayNames.forEach(day => {
                const dayEl = document.createElement('div');
                dayEl.textContent = day;
                headerRow.appendChild(dayEl);
            });
            calendarEl.appendChild(headerRow);

            // Add empty cells for days before the first of the month
            for (let i = 0; i < firstDay; i++) {
                const emptyCell = document.createElement('div');
                emptyCell.classList.add('calendar-day', 'empty');
                calendarEl.appendChild(emptyCell);
            }

            // Add day cells
            const today = new Date();
            today.setHours(0, 0, 0, 0); // Normalize today to midnight for comparison

            for (let day = 1; day <= daysInMonth; day++) {
                const dayCell = document.createElement('div');
                dayCell.classList.add('calendar-day');
                dayCell.textContent = day;
                const dateKey = `${year}-${String(month + 1).padStart(2, '0')}-${String(day).padStart(2, '0')}`;
                const currentDate = new Date(year, month, day);
                currentDate.setHours(0,0,0,0); // Normalize current cell date

                if (availableSlots[dateKey] && availableSlots[dateKey].length > 0 && currentDate >= today) {
                    dayCell.classList.add('available');
                    dayCell.addEventListener('click', () => selectDate(dateKey, dayCell));
                } else {
                    dayCell.classList.add('unavailable');
                }
                if (selectedDate === dateKey) {
                    dayCell.classList.add('selected');
                }
                calendarEl.appendChild(dayCell);
            }
        }

        function prevMonth() {
            currentMonth--;
            if (currentMonth < 0) {
                currentMonth = 11;
                currentYear--;
            }
            generateCalendar(currentMonth, currentYear);
        }

        function nextMonth() {
            currentMonth++;
            if (currentMonth > 11) {
                currentMonth = 0;
                currentYear++;
            }
            generateCalendar(currentMonth, currentYear);
        }

        function selectDate(dateKey, dayCell) {
            selectedDate = dateKey;
            selectedTime = null; // Reset time selection
            document.querySelectorAll('.calendar-day.selected').forEach(cell => cell.classList.remove('selected'));
            dayCell.classList.add('selected');
            displayTimeSlots(dateKey);
            document.getElementById('bookingFormSection').style.display = 'none'; // Hide form if a new date is selected
            document.getElementById('confirmationSection').style.display = 'none'; // Hide confirmation if a new date is selected
        }

        function displayTimeSlots(dateKey) {
            timeSlotsEl.innerHTML = ''; // Clear previous time slots
            const slots = availableSlots[dateKey];
            if (!slots || slots.length === 0) {
                timeSlotsEl.innerHTML = '<p>No slots available for this date.</p>';
                return;
            }

            const slotsContainer = document.createElement('div');
            slotsContainer.className = 'time-slots-container';
            slots.forEach(time => {
                const slotButton = document.createElement('button');
                slotButton.classList.add('time-slot-button');
                slotButton.textContent = formatTimeForDisplay(time);
                slotButton.addEventListener('click', () => selectTime(time, slotButton));
                if (selectedTime === time) {
                    slotButton.classList.add('selected');
                }
                slotsContainer.appendChild(slotButton);
            });
            timeSlotsEl.appendChild(slotsContainer);
            timeSlotsEl.style.display = 'block';
        }

        function formatTimeForDisplay(timeStr) { // timeStr is HH:MM
            const [hours, minutes] = timeStr.split(':').map(Number);
            const ampm = hours >= 12 ? 'PM' : 'AM';
            const displayHours = hours % 12 || 12; // Convert 0 to 12 for 12 AM/PM
            return `${displayHours}:${String(minutes).padStart(2, '0')} ${ampm} EST`;
        }

        function selectTime(time, slotButton) {
            selectedTime = time;
            document.querySelectorAll('.time-slot-button.selected').forEach(btn => btn.classList.remove('selected'));
            slotButton.classList.add('selected');
            document.getElementById('bookingFormSection').style.display = 'block';
            document.getElementById('bookingFormSection').scrollIntoView({ behavior: 'smooth' });
            // Pre-fill summary in form, if needed, or do it on submit
        }

        document.addEventListener('DOMContentLoaded', () => {
            const today = new Date();
            generateCalendar(today.getMonth(), today.getFullYear());

            const bookingForm = document.getElementById('demoBookingForm');
            if (bookingForm) {
                bookingForm.addEventListener('submit', function(event) {
                    event.preventDefault();
                    if (!selectedDate || !selectedTime) {
                        alert('Please select a date and time for your demo class.');
                        return;
                    }

                    bookingData = {
                        firstName: document.getElementById('firstName').value,
                        lastName: document.getElementById('lastName').value,
                        email: document.getElementById('email').value,
                        frenchLevel: document.getElementById('frenchLevel').value,
                        notes: document.getElementById('notes').value,
                        date: selectedDate,
                        time: selectedTime
                    };

                    displayConfirmationAndNotifyAdmin(bookingData);
                });
            }
        });

        function displayConfirmationAndNotifyAdmin(data) {
            const confirmationSection = document.getElementById('confirmationSection');
            const bookingSummaryEl = document.getElementById('bookingSummary');
            const formSection = document.getElementById('bookingFormSection');
            const calendarInterface = document.querySelector('.booking-interface');

            // Format date and time for display
            const [year, month, day] = data.date.split('-').map(Number);
            const dateDisplay = `${monthNames[month - 1]} ${day}, ${year}`;
            const displayTime = formatTimeForDisplay(data.time);

            // Hide calendar and form, show initial confirmation message
            if(calendarInterface) calendarInterface.style.display = 'none';
            if(formSection) formSection.style.display = 'none';
            if(timeSlotsEl) timeSlotsEl.style.display = 'none';

            bookingSummaryEl.innerHTML = `
                <h2><i class="fas fa-spinner fa-spin"></i> Processing Your Booking...</h2>
                <p class="lead">Please wait while we save your demo class request.</p>
            `;
            confirmationSection.style.display = 'block';
            confirmationSection.scrollIntoView({ behavior: 'smooth' });

            // Prepare data for PHP script
            const formData = new FormData();
            formData.append('firstName', data.firstName);
            formData.append('lastName', data.lastName);
            formData.append('email', data.email);
            formData.append('frenchLevel', data.frenchLevel);
            formData.append('notes', data.notes || '');
            formData.append('date', data.date); // Original YYYY-MM-DD from selectedDate
            formData.append('time', data.time); // Original HH:MM from selectedTime
            formData.append('googleMeetLink', GOOGLE_MEET_LINK); // Add the static Google Meet link

            fetch('submit_demo_booking.php', {
                method: 'POST',
                body: formData
            })
            .then(response => response.json())
            .then(phpResponse => {
                let userMessageHTML = '';
                if (phpResponse.status === 'success') {
                    userMessageHTML = `
                        <h2><i class="fas fa-check-circle" style="color: var(--brand-success);"></i> Thank You, ${data.firstName}!</h2>
                        <p class="lead">Your demo class request has been successfully submitted!</p>
                        <div class="booking-summary-details card">
                            <h4>Booking Details:</h4>
                            <p><strong>Name:</strong> ${data.firstName} ${data.lastName}</p>
                            <p><strong>Email:</strong> ${data.email}</p>
                            <p><strong>Date:</strong> ${dateDisplay}</p>
                            <p><strong>Time:</strong> ${displayTime} (1 hour session)</p>
                            <p><strong>Your Stated French Level:</strong> ${data.frenchLevel || 'Not specified'}</p>
                            <p><strong>Notes:</strong> ${data.notes || 'None'}</p>
                            <p><strong>Meet Link Ref:</strong> (Sent via email)</p>
                            <hr>
                            <p><strong>Next Steps:</strong></p>
                            <ol>
                                <li>You will receive an <strong>official confirmation email</strong> from <strong>${ADMIN_EMAIL}</strong> (via our Hostinger system) with the <strong>Google Meet link</strong> and preparation tips within the next few hours.</li>
                                <li>Please check your spam/junk folder if you don't see it.</li>
                                <li>Our team has also been notified via the database.</li>
                            </ol>
                        </div>
                    `;

                    // Admin Mailto Notification Logic (secondary)
                    const adminSubject = `DB ‚úîÔ∏è - New Demo Booking: ${data.firstName} ${data.lastName} - ${dateDisplay} at ${displayTime}`;
                    const adminBody = `
New Demo Class Booking (SAVED TO DATABASE):
---------------------------------
Name: ${data.firstName} ${data.lastName}
Email: ${data.email}
Requested Date: ${dateDisplay} (${data.date})
Requested Time: ${displayTime} (${data.time} EST)
Selected Level: ${data.frenchLevel || 'Not specified'}
Notes: ${data.notes || 'None'}
---------------------------------
Google Meet Link for this demo: ${GOOGLE_MEET_LINK}
---------------------------------
ACTION REQUIRED (Database record exists):
1. Verify booking in admin panel / database.
2. Ensure student (${data.email}) receives official HTML confirmation email via Hostinger process.

--
FRENCH.GTA Demo Booking System`.trim();
                    const adminMailtoLink = `mailto:${ADMIN_EMAIL}?subject=${encodeURIComponent(adminSubject)}&body=${encodeURIComponent(adminBody)}`;
                    try { window.open(adminMailtoLink, '_blank'); } catch (e) { console.warn('Admin mailto failed'); }

                } else { // PHP script returned an error
                    userMessageHTML = `
                        <h2><i class="fas fa-exclamation-triangle" style="color: var(--brand-danger);"></i> Booking Submission Failed</h2>
                        <p class="lead">We encountered an error trying to save your booking: ${phpResponse.message}</p>
                        <p>Please try booking again. If the problem persists, contact us directly at ${ADMIN_EMAIL} or via WhatsApp.</p>
                        <div class="booking-summary-details card" style="opacity:0.7;">
                            <h4>Your Attempted Booking:</h4>
                            <p><strong>Name:</strong> ${data.firstName} ${data.lastName}</p>
                            <p><strong>Date:</strong> ${dateDisplay}, <strong>Time:</strong> ${displayTime}</p>
                        </div>
                    `;
                }
                bookingSummaryEl.innerHTML = userMessageHTML;
            })
            .catch(error => {
                console.error('Fetch Error for demo booking:', error);
                bookingSummaryEl.innerHTML = `
                    <h2><i class="fas fa-server" style="color: var(--brand-danger);"></i> Network Error</h2>
                    <p class="lead">A network error occurred while trying to submit your booking. Please check your internet connection and try again.</p>
                    <p>If the problem persists, contact us directly at ${ADMIN_EMAIL} or via WhatsApp.</p>
                `;
            });

            document.getElementById('demoBookingForm').reset();
            selectedDate = null;
            selectedTime = null;
            // bookingData is local to the submit event listener, no need to nullify here if it's not global for this function
        }

        function bookAnotherDemo() {
            // Reset UI to initial state
            document.getElementById('confirmationSection').style.display = 'none';
            document.querySelector('.booking-interface').style.display = 'block';
            if(timeSlotsEl) timeSlotsEl.style.display = 'none'; // Hide time slots
            if(document.getElementById('bookingFormSection')) document.getElementById('bookingFormSection').style.display = 'none'; // Hide form
            
            // Regenerate calendar to clear selection and show current month
            const today = new Date();
            generateCalendar(today.getMonth(), today.getFullYear());

            // Scroll to top or calendar
            document.querySelector('.booking-interface').scrollIntoView({ behavior: 'smooth' });
        }
    </script>
</body>
</html> 